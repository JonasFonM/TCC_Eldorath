generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["relationJoins"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model personagem {
  id               Int                    @id @default(autoincrement())
  criadoEm         DateTime               @default(now()) @db.Timestamp(0)
  nome             String                 @db.Text
  nivel            Int                    @default(1)
  xp               Int                    @default(0)
  tier             Int                    @default(1)
  ptsLinhagem      Int                    @default(2)
  ptsCaminhos      Int                    @default(1)
  ptsHabilidades   Int                    @default(2)
  ptsTreinos       Int                    @default(1)
  ouro             Int                    @default(50)
  agi              Int                    @default(1)
  cor              Int                    @default(1)
  det              Int                    @default(1)
  foc              Int                    @default(1)
  men              Int                    @default(1)
  vig              Int                    @default(1)
  derivados        derivados?             @relation
  defesas          defesa[]
  imunidades       imunidadeCondicao[]
  items            instanciaItem[]
  slotsItem        slotItem[]
  personagemAtaque personagemAtaque[]
  habilidades      habilidadePersonagem[]
  condicoes        condicaoPersonagem[]
  authorId         Int
  user             user                   @relation(fields: [authorId], references: [id], map: "character_ibfk_1")
}

model derivados {
  id             Int        @id @default(autoincrement())
  vitalidade     Int
  poder          Int
  ptsAcao        Int
  equilibrio     Int
  iniciativa     Int
  limiteMagico   Int
  tamanhoReal    Int
  tamanhoEfetivo Int
  capCarga       Int
  capLevantar    Int
  peso           Int
  danoCrit       Int
  defCrit        Int
  charId         Int        @unique
  personagem     personagem @relation(fields: [charId], references: [id], map: "derivados_fk_1")
}

model defesa {
  id           Int        @id @default(autoincrement())
  tipoFis      tipoFis?
  tipoMag      tipoMag?
  imune        Boolean
  valorFixo    Int
  valorPorDado Int
  personagem   personagem @relation(fields: [personagemId], references: [id])
  personagemId Int
}

model imunidadeCondicao {
  id           Int          @id @default(autoincrement())
  tipoCondicao tipoCondicao
  personagemId Int          @unique
  personagem   personagem   @relation(fields: [personagemId], references: [id], map: "imunidades_fk_1")
}

model personagemAtaque {
  id           Int        @id @default(autoincrement())
  personagemId Int
  personagem   personagem @relation(fields: [personagemId], references: [id])
  alvoId       Int?
  atributo     String
  alcance      Int
  ptsAcao      Int
  brutal       Boolean    @default(false)
  dadosDano    dadoDano[]
}

model dadoDano {
  id        Int              @id @default(autoincrement())
  tipoDado  Int
  numDados  Int
  bonusFixo Int              @default(0)
  tipoFis   tipoFis?
  tipoMag   tipoMag?
  idAtaque  Int
  ataque    personagemAtaque @relation(fields: [idAtaque], references: [id])
}

enum tipoFis {
  Corte
  Impacto
  Perfurante

  Total
}

enum tipoMag {
  Elemental
  Acido
  Aquatico
  Eletrico
  Flamejante

  Hermetico
  Arcano
  Cosmico
  Mental

  Profano
  Sagrado

  Total
}

model efeitoAplicado {
  id       Int        @id @default(autoincrement())
  tipoAlvo alvoEfeito
  alvoId   Int
  efeitoId Int
  efeito   efeito     @relation(fields: [efeitoId], references: [id])
}

enum alvoEfeito {
  personagem
  instanciaItem
}

model habilidade {
  id         Int                    @id @default(autoincrement())
  tipo       tipoCondicao
  efeitos    efeitoHabilidade[]
  personagem habilidadePersonagem[]
}

model habilidadePersonagem {
  id           Int        @id @default(autoincrement())
  personagemId Int
  habilidadeId Int
  habilidade   habilidade @relation(fields: [habilidadeId], references: [id])
  personagem   personagem @relation(fields: [personagemId], references: [id])
}

model efeitoHabilidade {
  id           Int        @id @default(autoincrement())
  efeitoId     Int
  habilidadeId Int
  habilidade   habilidade @relation(fields: [habilidadeId], references: [id])
  efeito       efeito     @relation(fields: [efeitoId], references: [id])
}

model condicao {
  id           Int                  @id @default(autoincrement())
  tipoCondicao tipoCondicao
  efeitos      efeitoCondicao[]
  personagens  condicaoPersonagem[]
}

model condicaoPersonagem {
  id           Int        @id @default(autoincrement())
  personagemId Int
  condicaoId   Int
  condicao     condicao   @relation(fields: [condicaoId], references: [id])
  personagem   personagem @relation(fields: [personagemId], references: [id])
}

model efeitoCondicao {
  id         Int      @id @default(autoincrement())
  efeitoId   Int
  condicaoId Int
  condicao   condicao @relation(fields: [condicaoId], references: [id])
  efeito     efeito   @relation(fields: [efeitoId], references: [id])
}

enum tipoCondicao {
  Agarrado
  Amarrado
  Alienado
  Amedrontado
  Atordoado
  Camuflado
  Caindo
  Cegado
  Cintilante
  Coberto
  Congelado
  Corroendo
  Derretendo
  Derrubado
  Desarmado
  Drenado
  Encantado
  Encharcado
  Enfraquecido
  Envenenado
  Ensurdecido
  Escondido
  Escravizado
  Esmagado
  Estonteado
  Exausto
  Flutuando
  Lento
  Luminoso
  Insano
  Invisivel
  Imovel
  Marcado
  Montado
  Nauseado
  Obscurecido
  Paralisado
  Sangrando
  Silenciado
  Sobrecarregado
  Submerso
  Sufocado
  Surpreso
  Suspenso
}

model efeito {
  id              Int                @id @default(autoincrement())
  nome            String
  atributoAfetado String
  valor           Float
  operador        operador
  duracao         Int
  ativacao        ativaEfeito
  condicoes       efeitoCondicao[]
  habilidades     efeitoHabilidade[]
  efeitoAplicado  efeitoAplicado[]
  instanciaItem   instanciaItem?     @relation(fields: [instanciaItemId], references: [id])
  instanciaItemId Int?
}

enum operador {
  Soma
  Subtrai
  Multiplica
  Divide
}

enum ativaEfeito {
  Acerto
  Brutal
  Passivo
}

model itemBase {
  id         Int             @id @default(autoincrement())
  nome       String          @default("Item")
  custoBase  Int
  pesoBase   Int
  tipo       tipoItem
  subtipo    subTipoItem
  instancias instanciaItem[]
}

model slotItem {
  id              Int            @id @default(autoincrement())
  tipoSlot        tipoItem
  item            instanciaItem? @relation(fields: [instanciaItemId], references: [id])
  instanciaItemId Int?
  personagem      personagem     @relation(fields: [personagemId], references: [id])
  personagemId    Int
}

model instanciaItem {
  id             Int          @id @default(autoincrement())
  tier           Int          @default(0)
  custoReal      Int
  pesoReal       Int
  atributoBase   String?
  personagemId   Int
  itemBaseId     Int
  tipoItem       tipoItem
  efeitos        efeito[]
  personagem     personagem?  @relation(fields: [personagemId], references: [id])
  itemBase       itemBase     @relation(fields: [itemBaseId], references: [id])
  materialItem   materialItem @relation(fields: [materialItemId], references: [id])
  materialItemId Int
  slotItem       slotItem[]
}

model materialItem {
  id    Int             @id @default(autoincrement())
  nome  String
  valor Int
  itens instanciaItem[]
}

enum tipoItem {
  MaoLivre
  Elmo
  Ombreira
  Luva
  Anel
  Manto
  Peitoral
  Pingente
  Cintura
  Pernas
  Bota
}

enum subTipoItem {
  Arco
  Discreta
  Arremesso
  ArmaFogo
  Haste
  Natural
  Arpao
  Besta
  Chicote
  Clava
  Corrente
  Desarmado
  EspadaCampo
  EspadaDuelo
  Foice
  LancaMontada
  Machado
  Martelo
  ArmaduraLeve
  ArmaduraMedia
  ArmaduraPesada
  EscudoLeve
  EscudoMedio
  EscudoPesado
}

model user {
  id          Int          @id @default(autoincrement())
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  email       String       @unique
  username    String
  password    String
  personagens personagem[] @relation()
}
